# Dipakai untuk development: hot reload, port terbuka, tanpa nginx
# Cara pakai: docker compose -f docker-compose.yml -f docker-compose.dev.yml up

services:
  postgres:
    ports:
      - "5432:5432" # sudah terbuka di base, eksplisit di sini untuk clarity

  minio:
    ports:
      - "9000:9000"
      - "9001:9001"

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev # pakai Dockerfile khusus dev (air hot reload)
    environment:
      APP_ENV: development
      DB_SSLMODE: disable
    volumes:
      - ./backend:/app # mount source code untuk hot reload
      - /app/vendor # exclude vendor folder
    ports:
      - "8080:8080"

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev # Next.js dev server
    volumes:
      - ./frontend:/app
      - /app/node_modules
    environment:
      NEXT_PUBLIC_API_URL: http://localhost:8080
    ports:
      - "3000:3000"

  # Tidak pakai nginx di development
  nginx:
    profiles:
      - production # hanya aktif jika profile 'production' dipanggil
